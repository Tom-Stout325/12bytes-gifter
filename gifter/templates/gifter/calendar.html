{% extends "index.html" %}
{% load static %}

{% block title %}Family Calendar | Gifter{% endblock %}

{% block content %}
<style>
  /* Calendar layout */
  .calendar-table {
    table-layout: fixed;
  }
  .calendar-day {
    vertical-align: top;
    height: 5.5rem;           /* fixed height for all days */
    padding: 0.25rem;
  }
  .calendar-day-inner {
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow: hidden;
  }
  .calendar-day-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.15rem;
  }
  .calendar-day-events {
    overflow: hidden;
  }
  .calendar-day-events ul {
    font-size: 0.75rem;
  }
  .calendar-day-events li {
    max-width: 100%;
  }
  .calendar-day-muted {
    background-color: #f8f9fa;
    color: #adb5bd;
  }
</style>

<div class="container mt-4" style="max-width: 900px;">

  <!-- Header + navigation -->
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
    <div class="d-flex flex-column">
      <h2 class="h4 text-secondary mb-0">Family Calendar</h2>
      <span class="text-muted small">{{ month_label }}</span>
    </div>
    <div class="d-flex flex-wrap gap-2">
      <a href="{% url 'gifter:calendar_month' year=prev_year month=prev_month %}"
         class="btn btn-sm btn-outline-secondary">
        ‚Üê Previous
      </a>
      <a href="{% url 'gifter:calendar_current' %}"
         class="btn btn-sm btn-outline-secondary">
        Today
      </a>
      <a href="{% url 'gifter:calendar_month' year=next_year month=next_month %}"
         class="btn btn-sm btn-outline-secondary">
        Next ‚Üí
      </a>
    </div>
  </div>

  <!-- Legend -->
  <div class="mb-3 small text-muted">
    <span class="me-3">
      <span class="badge bg-light text-dark border me-1">üéÇ</span> Birthday
    </span>
    <span class="me-3">
      <span class="badge bg-light text-dark border me-1">üíç</span> Anniversary
    </span>
    <span class="me-3">
      <span class="badge bg-light text-dark border me-1">üì¢</span> Announcement
    </span>
  </div>

  <!-- Calendar grid -->
  <div class="table-responsive">
    <table class="table table-bordered align-middle text-center small mb-4 calendar-table">
      <thead class="table-light">
        <tr>
          <th scope="col">Mon</th>
          <th scope="col">Tue</th>
          <th scope="col">Wed</th>
          <th scope="col">Thu</th>
          <th scope="col">Fri</th>
          <th scope="col">Sat</th>
          <th scope="col">Sun</th>
        </tr>
      </thead>
      <tbody>
        {% for week in weeks %}
          <tr>
            {% for cell in week %}
              {% with d=cell.date events=cell.events in_month=cell.in_current_month %}
                <td class="calendar-day {% if not in_month %}calendar-day-muted{% endif %}">
                  <div class="calendar-day-inner">
                    <div class="calendar-day-header">
                      <span class="fw-semibold">{{ d.day }}</span>
                      {% if d == today %}
                        <span class="badge bg-primary">Today</span>
                      {% endif %}
                    </div>

                    {% if events %}
                      <div class="calendar-day-events">
                        <ul class="list-unstyled mb-0 text-start">
                          {% for e in events %}
                            <li class="mb-1">
                              {% if e.type == "birthday" %}
                                <span class="me-1">üéÇ</span>
                                <span class="d-inline-block" style="max-width: 100%; white-space: normal; line-height: 1.1;">
                                  {{ e.label }}
                                </span>
                              {% elif e.type == "anniversary" %}
                                <span class="me-1">üíç</span>
                                <span class="d-inline-block" style="max-width: 100%; white-space: normal; line-height: 1.1;">
                                  {{ e.label }}
                                </span>
                              {% elif e.type == "announcement" %}
                                <span class="me-1">üì¢</span>
                                {% if e.post %}
                                  <a
                                    href="{% url 'gifter:board_detail' pk=e.post.pk %}"
                                    class="text-truncate d-inline-block"
                                    style="max-width: 80%;">
                                    {{ e.label|truncatechars:20 }}
                                  </a>
                                {% else %}
                                  <span class="text-truncate d-inline-block" style="max-width: 80%;">
                                    {{ e.label|truncatechars:20 }}
                                  </span>
                                {% endif %}
                              {% endif %}
                            </li>
                          {% endfor %}
                        </ul>
                      </div>
                    {% endif %}
                  </div>
                </td>
              {% endwith %}
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

    <!-- Summary list (desktop + mobile) -->
  <div class="mt-4">
    <h3 class="h6 text-secondary mb-2">This month‚Äôs events</h3>

    {% for week in weeks %}
      {% for cell in week %}
        {% if cell.in_current_month and cell.events %}
          <div class="mb-2">
            <div class="fw-semibold">
              {{ cell.date|date:"M j" }}
            </div>
            <ul class="list-unstyled mb-0 small">
              {% for e in cell.events %}
                <li>
                  {% if e.type == "birthday" %}
                    üéÇ {{ e.label }}
                  {% elif e.type == "anniversary" %}
                    üíç {{ e.label }}
                  {% else %}
                    üì¢
                    {% if e.post %}
                      <a href="{% url 'gifter:board_detail' pk=e.post.pk %}">
                        {{ e.label }}
                      </a>
                    {% else %}
                      {{ e.label }}
                    {% endif %}
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      {% endfor %}
    {% endfor %}

    {% if not has_events %}
      <p class="text-muted small mb-0">No events this month yet.</p>
    {% endif %}
  </div>


</div>
{% endblock %}
