{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{% block title %}Gifter{% endblock %}</title>

    <!-- SEO & Open Graph -->
    {% block head_meta %}
      <meta name="description" content="Manage your family's wish list!"/>
      <meta property="og:title" content="Gifter App" />
      <meta property="og:description" content="Your family wish list!"/>
      <meta property="og:type" content="website" />

      {# TODO: replace this with your live domain or dynamic share URL #}
      <meta property="og:url" content="https://www.yourdomain.com/gifter" />

      {# TODO: replace with a real preview image for social sharing #}
      <meta property="og:image" content="https://www.yourdomain.com/static/images/og-banner.jpg"/>

      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:title" content="Gifter App" />
      <meta name="twitter:description" content="Your family wish list!"/>
      <meta name="twitter:image" content="https://www.yourdomain.com/static/images/twitter-banner.jpg"/>
    {% endblock head_meta %}

    <!-- Favicon / App Icons -->
    <link rel="icon" href="{% static 'images/favicon.ico' %}" sizes="32x32" type="image/x-icon"/>
    <link rel="apple-touch-icon" href="{% static 'images/favicon.ico' %}"/>

    {% comment %} 
      {# CSRF token helper for custom JS fetch() calls.
       Django does not automatically use this.
       Keep it if you plan to manually attach it to AJAX later. #} 
    {% endcomment %}
    <meta name="csrf-token" content="{{ csrf_token }}" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet"/>

    <!-- Bootstrap CSS (CDN) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"/>

    <!-- Font Awesome (CDN) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

    <!-- Global Custom Styles -->
    <link rel="stylesheet" href="{% static 'styles/index.css' %}" />

    <!-- Page-Specific Styles -->
    {% block extra_css %}{% endblock %}
  </head>

  <body class="{% block body_class %}{% endblock %}">
    {% include 'navbar.html' %}

    <!-- Flash Messages -->
    <div class="container mt-4">
      {% if messages %}
        {% for message in messages %}
          <div
            class="alert alert-{{ message.tags }} alert-dismissible fade show"
            role="alert">
            {{ message }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="Close">
            </button>
          </div>
        {% endfor %}
      {% endif %}
    </div>

    <!-- Main Page Content -->
    <div class="container mt-3">
      {% block content %}{% endblock %}
    </div>

    <!-- Bootstrap JS (with Popper) -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- Page-Specific Scripts -->
    {% block extra_js %}{% endblock %}
    {% block footer_js %}{% endblock %}
  </body>
</html>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const body = document.body;
    const themeToggle = document.getElementById("theme-toggle");
    const themeIcon = document.getElementById("theme-icon");

    if (!themeToggle || !themeIcon) {
      // Navbar toggle not present (e.g. logged-out state) -> do nothing
      return;
    }

    function applyTheme(isDark) {
      if (isDark) {
        body.classList.add("dark-mode");

        // icon -> sun
        if (themeIcon.classList.contains("fa-moon")) {
          themeIcon.classList.replace("fa-moon", "fa-sun");
        } else {
          themeIcon.classList.add("fa-sun");
          themeIcon.classList.remove("fa-moon");
        }

        // button outline = light
        themeToggle.classList.remove("btn-outline-dark");
        themeToggle.classList.add("btn-outline-light");
      } else {
        body.classList.remove("dark-mode");

        // icon -> moon
        if (themeIcon.classList.contains("fa-sun")) {
          themeIcon.classList.replace("fa-sun", "fa-moon");
        } else {
          themeIcon.classList.add("fa-moon");
          themeIcon.classList.remove("fa-sun");
        }

        // button outline = dark
        themeToggle.classList.remove("btn-outline-light");
        themeToggle.classList.add("btn-outline-dark");
      }
    }

    // load starting theme from localStorage or system preference
    const savedTheme = localStorage.getItem("theme");
    const prefersDark =
      window.matchMedia &&
      window.matchMedia("(prefers-color-scheme: dark)").matches;

    const startDark = savedTheme
      ? savedTheme === "dark"
      : prefersDark;

    applyTheme(startDark);

    // handle click toggle
    themeToggle.addEventListener("click", () => {
      const willBeDark = !body.classList.contains("dark-mode");
      applyTheme(willBeDark);
      localStorage.setItem("theme", willBeDark ? "dark" : "light");
    });
  });
</script>


