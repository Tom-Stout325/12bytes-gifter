{% load static %}

<nav
  class="navbar navbar-expand-lg navbar-dark"
  style="background-color: var(--color-secondary)">
  <div class="container-fluid">
    <!-- Brand -->
    <a
      class="navbar-brand d-flex align-items-center fw-semibold"
      href="{% url 'gifter:home' %}">
      <img
        src="{% static 'images/logo.png' %}"
        alt="Gifter Logo"
        class="me-2"
        style="height: 36px; width: auto"
        id="navbar-logo"/>
      Gifter
    </a>

    <!-- Mobile Toggle Button -->
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#mainNav"
      aria-controls="mainNav"
      aria-expanded="false"
      aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible Content -->
    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        {% if not request.user.is_authenticated %}
          <li class="nav-item">
            <a class="nav-link" href="{% url 'accounts:login' %}">
              <i class="fa-solid fa-right-to-bracket me-1"></i> Login
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'accounts:register' %}">
              <i class="fa-solid fa-user-plus me-1"></i> Register
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'accounts:password_change' %}">
              <i class="fa-solid fa-key me-1"></i> Change Password
            </a>
          </li>

        {% else %}
        {% with user.profile as p %} 
        {% if not p%}
          <li class="nav-item">
            <a class="nav-link" href="{% url 'accounts:logout' %}">
              <i class="fa-solid fa-right-from-bracket me-1"></i> Logout
            </a>
          </li>
        {% else %}
        {% if p.is_approved %}

          <!-- Home -->
          <li class="nav-item">
            <a class="nav-link" href="{% url 'gifter:home' %}">
              <i class="fa-solid fa-house me-1"></i> Home
            </a>
          </li>

          <!-- My Profile -->
          <li class="nav-item">
            <a
              class="nav-link"
              href="{% url 'accounts:profile_detail' username=user.username %}"
            >
              <i class="fa-solid fa-user me-1"></i> My Profile
            </a>
          </li>

          <!-- Edit My Profile -->
          <li class="nav-item">
            <a class="nav-link" href="{% url 'accounts:profile_edit' %}">
              <i class="fa-solid fa-pen-to-square me-1"></i> Edit Profile
            </a>
          </li>


        {% else %}
          <!-- Pending approval view only -->
          <li class="nav-item">
            <a class="nav-link" href="{% url 'accounts:pending_approval' %}">
              <i class="fa-solid fa-clock me-1"></i> Pending Approval
            </a>
          </li>

          <!-- Edit to fix their info while waiting -->
          <li class="nav-item">
            <a class="nav-link" href="{% url 'accounts:profile_setup' %}">
              <i class="fa-solid fa-pen-to-square me-1"></i> Complete Profile
            </a>
          </li>
        {% endif %}

        <!-- Role badge / identity summary -->
        <li class="nav-item d-flex align-items-center ms-lg-3 mt-2 mt-lg-0">
          <span
            class="badge bg-emphasis text-dark fw-semibold"
            style="font-size: 0.8rem">
            {{ user.first_name }}
            {% if user.last_name %} {{ user.last_name }}{% endif %}
            {% if p.role == "Parent" %}
              Â· {{ p.role }}
            {% endif %}
          </span>
        </li>


        <!-- Logout -->
        <li class="nav-item ms-lg-3">
          <a class="nav-link" href="{% url 'accounts:logout' %}">
            <i class="fa-solid fa-right-from-bracket me-1"></i> Logout
          </a>
        </li>

        {% endif %} 
        {% endwith %} 
        {% endif %}
        <li class="nav-item ms-lg-3 my-2 my-lg-0">
          <button
            id="theme-toggle"
            class="btn btn-sm btn-outline-light d-flex align-items-center justify-content-center"
            type="button"
            aria-label="Toggle theme"
            style="min-width: 2rem; min-height: 2rem; line-height: 1;">
            <i id="theme-icon" class="fa-solid fa-moon" style="font-size: 0.9rem; line-height: 1;"></i>
          </button>
        </li>

      </ul>
    </div>
  </div>
</nav>
